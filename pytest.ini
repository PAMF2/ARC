[pytest]
# Pytest configuration for Banking Syndicate

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*

# Test paths
testpaths = tests .

# Minimum Python version
minversion = 3.10

# Output options
addopts =
    # Verbose output
    -v
    # Show local variables in tracebacks
    --showlocals
    # Show test summary info
    -ra
    # Strict markers - fail on unknown markers
    --strict-markers
    # Warnings
    --tb=short
    # Coverage (when using pytest-cov)
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-config=.coveragerc
    # Fail on warnings (can be disabled with -W ignore)
    # -W error
    # Show durations of slowest tests
    --durations=10
    # Disable warnings about unregistered marks
    --strict-config

# Test markers for categorization
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (may require external services)
    slow: Tests that take a long time to run
    api: Tests that interact with external APIs
    blockchain: Tests related to blockchain functionality
    ai: Tests involving AI/ML models (Anthropic, Gemini, OpenAI)
    security: Security-focused tests
    validation: Validation protocol tests
    circle: Circle API integration tests
    arc: Anthropic ARC integration tests
    gemini: Google Gemini AI tests
    commerce: Agentic commerce tests
    baas: Banking-as-a-Service tests
    asyncio: Async/await tests
    mock: Tests using mocked dependencies
    requires_env: Tests requiring environment variables
    requires_api_keys: Tests requiring valid API keys
    smoke: Quick smoke tests for basic functionality
    regression: Regression tests for previously fixed bugs

# Async tests configuration
asyncio_mode = auto

# Coverage options (used with --cov)
# See .coveragerc for detailed coverage configuration

# Console output styling
console_output_style = progress

# Log configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Ignore patterns
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .venv
    venv
    env
    .env
    node_modules
    banking_data
    outputs
    memory
    logs

# Doctest configuration
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# Timeout for tests (in seconds)
# Requires pytest-timeout
timeout = 300
timeout_method = thread

# Parallel execution (requires pytest-xdist)
# Uncomment to enable parallel test execution
# addopts = -n auto

# Ignore deprecation warnings from dependencies
filterwarnings =
    ignore::DeprecationWarning:anthropic.*
    ignore::DeprecationWarning:google.*
    ignore::DeprecationWarning:openai.*
    # Add warnings you want to ignore here
    # ignore::UserWarning

# Environment variables for tests
# These can be overridden in CI/CD or local .env
env =
    PYTEST_RUNNING=1
    TEST_MODE=1
    LOG_LEVEL=INFO

# Fixtures
# pytest will look for conftest.py in these directories
# for fixture definitions

# Custom pytest plugins
# plugins = pytest_custom_plugin

# Test collection
# Don't collect files matching these patterns
collect_ignore =
    setup.py
    conftest.py
    __init__.py

# Reporting
# Generate JUnit XML report for CI/CD integration
# junit_family = xunit2
# junit_logging = all

# Cache
# pytest caching for faster re-runs
cache_dir = .pytest_cache

# Terminal reporting
# show extra test summary info
# -r chars: (f)ailed, (E)error, (s)skipped, (x)failed, (X)passed,
#           (p)assed, (P)assed with output, (a)ll except passed
# Example: -rfEX shows failed, error, and passed with exception
# console_output_style = progress

# Hook implementations
# python_files = test_*.py *_test.py testing/*/*.py
